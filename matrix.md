# Matrix 開発マニュアル

# 1.新規開発者の作成


:::info
管理者権限を持つアカウントで操作を行ってください。

以下の説明は、システムのデフォルトアカウント「admin」を使用して説明いたします。

:::

### 1.1 左側メニューの「開発者管理」をクリックする

 ![開発者管理](attachments/0cb483e3-46b6-4c5e-950c-5e17292b36a9.png)

### 1.2 「開発者の追加」をクリックし、開発者のメールアドレスを入力してください

 ![開発者追加](attachments/fdaba536-5368-44e4-ba11-a2d15eb508d8.png)

 ![](attachments/ff0d5fe4-2758-4ec5-84df-aa3ad3d49546.png)

### 1.3 メールボックスで確認メールを受信してください

 ![](attachments/b36dc53a-4ceb-40e6-8ac6-cf35b6de21fa.png)

### 1.4 認証メールのリンクを使用し、パスワードを再設定する

 ![Verify](attachments/f9bfa995-1c1e-4e98-8a5f-fdb26b129833.png)

### 1.5 左側のメニューから「権限管理」をクリックする

 ![権限管理](attachments/421b628e-1fdf-42c9-a0ac-0f547b92aa4c.png)

### 1.6「新しい権限を作成」をクリックし、権限の設定を行う

 ![左側の権限設定](attachments/8371dd32-4dff-472c-82c1-f6e28156ba63.png)

### 1.7 開発者に権限を付与す


:::warning
 左側のメニューに表示されるタブは、こちらで設定された権限に基づいて制御されます。

:::


:::tip
権限が付与されていない場合、ログインしても「403エラー」が表示されます。

:::

 ![](attachments/c016d1f7-d3cd-4567-b782-50a8179f45cf.png)


# 2.新しいプロジェクトを作成する

> 新しく作成した開発者アカウントでログインすると、ホームページは「プロジェクト」です。
>
>  ![](attachments/4cfee45f-652d-49b8-8990-5c14da092081.png)

### 2.1 「新しいプロジェクトを作成」ボタンをクリックし、プロジェクト情報を入力する

 ![空白のプロジェクトを作成する](attachments/eee9fc2a-5cd3-46ff-8e94-037dcdaaca9d.png)

 ![プロジェクトの基本情報を入力する](attachments/d2c4bee8-2f59-4df9-a182-780057ec790f.png)

### 2.2 プロジェクトに入る

> プロジェクト画面右上の折り畳みメニューから、さまざまな操作を実行できます。\n「編集」をクリックすると、プロジェクトの編集モード（NTMB）に入ります。
>
>  ![](attachments/5b0a1656-9d76-41f4-9746-12e453022a1e.png)


### 2.3 新しいページを作成する

> プロジェクトの編集モードに入った後、\n「==プロジェクト／ページ／コンポーネント管理==」をクリックし、\n「==ページ／コンポーネント==」から「==ページの追加==」をクリックし、新しいページを追加してください

 ![](attachments/f92bea0c-6f5b-4695-815b-62e5930e8891.png)

### 2.4 編集ページ - NTMB開発

> ページを追加すると、自動的にNTMBの開発画面に遷移する

 ![](attachments/d9227449-d6c6-4c02-80c3-76fb0c0dd0e1.png)


2\.4.1  左側のコンポーネントリストから、「input 入力ボックス」を2つ中央のキャンバスにドラッグしてください


:::info
左側のコンポーネントをドラッグ＆ドロップ、またはクリックすることで、右側のキャンバスに追加できます。

:::


 ![](attachments/aac27dff-2657-4ce2-bf8f-57209d8f3962.png)

#### 2.4.2 右側の詳細設定エリアで、それぞれのコンポーネントのid、name、タイトルを変更してください

| id | name | タイトル |
|----|----|----|
| Name | Name | Name |
| Age | Age | Age |

 ![](attachments/89d53942-a1fe-4709-9fb8-0f9c2aded79b.png)

### 2.5 プロジェクトのプレビュー

###  2.5.1 プロジェクトに権限を追加するには、まず権限設定画面にアクセスする必要があります。「プロジェクト／ページ／コンポーネント管理」>「プロジェクト情報」をクリックしてください。

 ![](attachments/d981cd3b-3183-4c9c-95ab-aa850ce81a15.png)

#### 2.5.2 「新しい権限を作成」をクリックしてください

 ![](attachments/3b63478d-179b-42a3-80b9-dfff9f16c7f5.png)

#### 2.5.3 「権限の作成」画面では、権限名、対象、表示を許可するページを入力してください

 ![](attachments/aac1ed72-fe4e-4e8f-af9e-d98059ca2518.png)


:::info
スイッチをOnにすることで、当該ページが表示されるようになります

 ![](attachments/49d797a5-347c-4118-956c-c2e847c671d5.png)

:::

# 3.DataModel のデータにアクセスする方法

## 3.1 最初のデータモデルを作成する


:::tip
学習目標：データモデルの構造を理解する

:::

左側の「DataModel」タブをクリック → 「DataModelを作成」→ 新しいデータモデルを作成します。

 ![](attachments/609654d8-64ea-4425-8855-7d22f6b56c26.png)


以下のような画面が表示されます。

 ![](attachments/77bd2f0d-1eef-4d09-a595-39b4c741fd56.png)


:::success
命名規則はシステムのガイドに従ってください。また、必要に応じてフィールドの型を設定することができます。

:::


### 3.1.1 DataModelのデータソース


:::tip
左上の「データソース」から、外部データベースを設定することができます。

:::

「選択」ボタンをクリックすると、使用予定のデータベースソースを設定できます。

 ![](attachments/28e42761-27f1-4d82-8472-7f0972c0b2d6.png)

下図は、データベース接続：`PostGreSQL`、テーブル：`public.item` を使用する例です。

 ![](attachments/763aff19-7d83-430a-b28c-85d55d7bde51.png)

 ![](attachments/362ed3da-5d7c-4e41-ace3-04bbf0f3b876.png)

### 3.1.2 DataModelのフィールド


:::tip
データソースを使用しない場合は、フィールドの型や長さを自由に設定し、Matrixシステム内にデータを保存することができます。\n対応しているフィールド型は以下の通りです。

:::

| タイプ |
|----|
| string |
| int |
| datetime |
| float |
| money |

 ![](attachments/8ea29529-2b4b-4662-9a0d-4516f70b5c6d.png)


### 3.1.3 DataModelの権限


:::tip
DataModel一覧画面では、各DataModelの管理操作が可能です。\nこの際、**対象のDataModelを閲覧する権限があるかどうか**にご注意ください。

:::

開発者に対して権限を手動で付与する場合は、該当するDataModelの右側にあるハンバーガーメニューをクリックし、権限を選択してください。

 ![](attachments/8c10251d-8b0f-45f4-8ce4-4366d1607202.png)

表示されるドロップダウンリストから、権限を付与したいメンバーを選択します。

 ![](attachments/f76432f1-aba1-446c-a63f-0fdd34d6232d.png)


## 3.2 DataModel とデータ連携を行う関連付けを作成します


:::tip
この操作では、NTMBの開発画面を使用して、フロントエンドのインターフェースを設計し、入力されたデータをDataModelに書き込む処理を行います。

:::

> a. まずは、空白のページを開き、以下のスキーマに従って画面とテーブルを作成してください。

| コンポーネント |  ID名 | 説明 |
|----|----|----|
| button | saveBtn | DataModelの保存イベントをトリガー |
| table(テーブル列数２、データ行数1) | table1 | DataModelのデータを表示 |
| input框 | id | DataModelのID項目に対応 |
| input框 | name | DataModelのName項目に対応 |
| button | addBtn | テーブルに追加された行数 |

UI画面 ![](attachments/11ea67b5-c4e6-46f8-a48a-5a143d4a67f4.png)


イベントを与える

* 保存DataModelデータをバインディングする

 ![](attachments/ae09b333-0a1e-44a2-87ce-b0ef1ec614bd.png)

 ![](attachments/f7dcc1ed-947e-43e8-a6cb-8f2d1233e4ec.png)

* テーブル列数の行を追加とaddボタンをバインディングする

 ![](attachments/34f88706-f09d-46e0-8066-268ce09f1947.png)

 ![](attachments/b742a525-54ed-42ca-8c13-55d9b60a1355.png)

 ![](attachments/b2189062-21d7-4d27-8d30-66d80aa91c9b.png)

 ![](attachments/3fd47336-8304-4a99-9024-1ba7155b07cc.png)

b. 画面上部にあるブロックアイコン（積み木アイコン）をクリックして、DataModel を作成します。

> \
>  ![](attachments/3d290776-ae68-4de2-b025-7ee193859f14.png)
>
> 「データ構造の生成」ボタンをクリックします。
>
>  ![](attachments/3012de05-fabe-4fd9-bcef-bf2cbfa1966b.png)
>
> \
> 「Body」右上のメニューから「新しいDataModelの作成」を選択します。
>
>  ![](attachments/8e8022fb-2c73-4751-b6dc-321815e4a72a.png)
>
> \
>   UI項目を読み込むかどうかを選択し、「確認」をクリックします。
>
>  ![](attachments/1824fd56-6559-45e1-b511-8d0a3900ae46.png)
>
> \
> システムにより対応する項目が自動生成されますので、以下の設定に従って作成してください。
>
> * DataModel ID:datamodel_edu
> * DataModel名:DMトレーニング
>
>  ![](attachments/a2e42347-3d3e-4101-9e36-db66adf9fbe3.png)
>
> 
:::warning
> PKは必ず指定してください。
>
> :::
>
> \

### 3.2.1 **UIとDataModelのバインディング**


:::tip
先ほど作成したDataModelを利用して、フロントエンドの入力項目とマッピングを行います。\nこれにより、画面上で入力されたデータがバックエンド（DataModel）に保存されるようになります。

:::

> \
> a.外枠およびBodyコンテナのDataModelバインド設定
>
>  ![](attachments/8e670c06-9705-426c-86ae-f0129ec4c4b5.png)
>
> \
> b. Body内の各入力フィールドをDataModel項目にバインドする ![](attachments/78235fa2-778e-40a8-8866-a73ce6851dda.png)
>
> \
>  ![](attachments/25512467-ba73-42c8-9b82-6edf6bd01786.png)

### 3.2.2 データの保存：DataModelへの書き込み


:::tip
データの関連付けが完了したら、フロントエンドに戻ってデータの書き込みをテストする ステップ3.2のイベントトリガーも完了していることを確認してください。

:::

> a. 画面上でテストデータを入力し、「保存」ボタンをクリックすることで、DataModel への書き込みが実行されます。
>
>  ![](attachments/12eaea02-ec89-4986-a262-af46942fc802.png)
>
> \nb.DataModel への書き込みが成功したかを確認するには、新しいページを開き、左側の「DataModel」タブをクリックし、対象の DataModel を選択して「データを表示」を実行してください。
>
>  ![](attachments/b7722d84-156d-47d6-a10c-e37fe113d893.png)\n

## 3.3 DataModelのフィルタ方法 → フィルターの使用


:::tip
前のステップで作成したテストデータを使用し、「id=apple」のデータのみを取得する

:::

> a. 既存のDataModelフィルターを作成する\n上部のブロックアイコンをクリック →「フィルター」を選択します。
>
>  ![](attachments/366f733b-fa2b-4df5-a77a-b61b3b413495.png)
>
> \
> \
> \n**フィルター条件の設定**
>
> * 名称：`appleを取得`
> * フィルターパス：`table1` の `body` を選択してください
> * 条件：`id = apple`

 ![](attachments/7ac0a23a-f8dc-459f-b683-f02cf70966db.png)

 ![](attachments/4df579d5-61fd-4d45-9b78-79619980a0b6.png)

 ![](attachments/c5cb6e6b-882d-4b98-a8be-0fa6af45d72a.png)

 ![](attachments/d6bd0ba4-6505-462f-83d3-d9211144ea15.png)

 ![](attachments/04e911a5-6923-4de8-8858-1b356f6ab2c6.png)

b. FormLoadイベントでDataModelのデータを読み込む（フィルターを使用）

> ==FormLoadイベントにフィルターを組み合わせて設定することで、ページ読み込み時に指定条件のDataModelデータを自動で取得することが可能です。==

>  ![](attachments/1dcfa4c5-3226-416f-98cd-258e27308a23.png)
>
> \
> \n再度「読み込むDatamodelデータ」イベントを選択し、先ほど作成したフィルターを指定してください。
>
>  ![](attachments/b1420110-58ef-4134-940a-25a268608726.png)
>
> \n上部の「目のアイコン」をクリックすると、プレビューが起動され、FormLoadイベントが発火し、id=appleのデータのみが取得されることを確認できます。
>
>  ![](attachments/48f0fd76-04a0-4ee4-9bc1-ae9f53047771.png)
>
>  ![](attachments/d5916dd4-1c41-4c80-a6d4-55d67a1e49b5.png)
>
> \

# 4.実際に練習してみよう

## 在庫検索システムを構築する

### **1.** Datamodel の作成 ➝ 材料在庫（ここでは既存のサンプルを使用します）

* 
:::tip
  学習目標 : Datamodel のデータ構造について理解する

  :::

  > 新しいデータモデルの作成![](attachments/2dace24c-268a-4c40-ae53-f9a9f43c6233.png)
  >
  > \
  > \
  > ==schemaは以下の通り参考してください==
  >
  > ![](attachments/9c10ccc2-fe51-4e36-ab50-d59c81579d24.png)
  >
  > \

| カラム ID | カラム名 | タイプ |
|----|----|----|
| productcode | 商品コード | string |
| productname | 商品名 | string |
| quantity | 在庫数 | int |
| remark | 備考 | string |
| lastupdated | 最終更新日 | string |
| category | カテゴリ | string |
| enable | 有効 | int |

  \

### 2.  在庫管理画面の設計 → ==データモデルのデータを表示するためのインターフェースを設計します。==

* 
:::tip
  学習目標 : 「NTMB」を使用してフロントエンド画面を設計し、在庫管理システムのフロントエンドインターフェースを作成する。

  :::

  2\.1 テーブルを作成する

  左側のコンポーネントリストから「テーブル」コンポーネントを選択し、画面上に配置します。（クリックとドラッグ二つとも配置できます。）![](attachments/f403aab7-c5e1-4991-8401-375872e69b4d.png)

  \
  \
  \
  2\.1.1 テーブルの列数を調整します。\n左側のテーブルの列数を「1」に、右側のテーブルの列数を「6」に設定します。

  ![](attachments/fa864b79-eadd-4001-90c1-13e9a37b2c49.png)

  \
  2\.1.2 空のテーブルに input フィールドを追加し、以下のスキーマに従って命名してください。左側（商品カテゴリテーブル）

| input ID | input名 |
|----|----|
| categoryname | categoryname |

  \n==右側(​材料在庫テーブル)==

| input ID | input 名 |
|----|----|
| StockID | StockID |
| productcode | 商品コード |
| productname | 商品名 |
| quantity | 在庫数 |
| remark | 備考 |
| ca_d(最後のカラム) | カテゴリ |
| enable(最後のカラム) | 有効 |

  2\.1.3 「商品インフォメーションテーブル」で最初の Input フィールド「StockID」には、以下のようにコードモードで記述してください

  ```javascript
  if ($nt.formData.table1.body[$nt.dataIndex].StockID)
  {
      return $nt.formData.table1.body[$nt.dataIndex].StockID
  }
  else
  {
      return $nt.formData.table1.body[$nt.dataIndex].guid
  }
  
  ```

  ![](attachments/4a5acd45-67ca-42f2-9070-68c506c955b1.png)

  \
  \
  \

### 3. DataModelからデータを取得し、画面に表示します。


1. 
:::tip
   学習目標 : 

   **a.** Datamodel「商品カテゴリ」を取得し、左側のテーブルに表示します。\n**b.** Datamodel「材料在庫」を取得し、右側のテーブルに表示します。

   :::

   **Datamodel と画面のマッピングを設定します。**

   > 
   > 1. 上部のブロックアイコンをクリックして、Datamodel 設定画面を開きます。

   ![](attachments/b8851ea5-e003-4788-9d24-9ba7e6f96d28.png)

   \
   \
   > b.右下の「==データ構造の生成==」をクリックします。
   >
   > ![](attachments/02a4290f-752d-4ce6-8e38-9967d8f9affb.png)

   \
   \
   > c. 外側の構造を選択し、「データモデルを選択」でDataModelを指定します。
   >
   > ![](attachments/ac9ca46f-e24c-4a74-b09c-39c646d46fb0.png)

   \
   > d. 検索バーで「demo」と検索し、すでに作成済みの「demo_material_stock」を素早く見つけます。![](attachments/43d16b3a-139d-4595-baec-ce068e5020ee.png)

   \
   > e. table2.body のテーブルでも同様の操作を行い、「demo_material_stock」をバインドします。
   >
   > ![](attachments/1e06ce94-eb7e-409f-9056-8a2a2e210b7a.png)

   \
   \
   > f. ドロップダウンメニューを使用して、DataModelのフィールドとUI上のテーブル列をマッピングします。![](attachments/4a50e6c5-0575-4ae7-8ead-a59fa0e0d000.png)

   \
   \
   > g. 左側の「商品カテゴリ」テーブルに対して、上記と同様の手順で、DataModel「物料庫存ca」とそのフィールドのマッピングを行います。
   >
   > ![](attachments/6f368e4e-1e51-4c83-b590-b33722bc6e88.png)

   ![](attachments/f78ba742-b202-4b1b-ab5c-f9c02e10c449.png)

   \
   \
   \
   3\.2 FormLoadイベントを使用して、DataModel内のデータを読み込みます。

   
:::info
   データのバインドが完了したら、「==読み込むDataModelデータ==」アクションを使用することで、データを画面上に表示できます。

   :::

   上部の「𐓏」アイコンをクリックし、新しいイベントを追加します。イベントの種類は「FormLoad」を選択し、右側の「＋」ボタンをクリックして「==読み込むDataModelデータ==」を選択してください。\n![](attachments/f3570da3-c60c-4a22-9045-3f3aaef147c4.png)

   \
   \
   \
   3\.2.1 プレビューアイコンをクリックすると、画面にデータモデルの接続設定で指定されたデータが表示されます。![](attachments/74970ae8-1d3b-46f7-9ef2-5285633735ff.png)

   \
   ![](attachments/ca3dcd7f-8ef6-41f5-b108-765b31fcf027.png)

   \
   \
   \
   \
   \

### 4.  Datamodelのフィルター機能を活用し、データの抽出・絞り込みを行います。


1. 
:::tip
   學習目標 : 

   
   1. 有効な商品データ（enable = 1）の取得
   2. 左側のカテゴリを選択後、右側には同じカテゴリに属する商品のみを表示します
   3. 在庫数によるフィルター処理

   :::

   ####  有効な商品データ（enable = 1）の取得

   > a. 上部のブロックアイコンをクリックし、「フィルター」を選択します。
   >
   > ![](attachments/5d650869-91ee-4056-be5c-2f5a47146007.png)

   \
   \
   \
   \
   \
   > b. 設定画面に進んだ後、右下の「フィルターの追加」をクリックします。![](attachments/a80e9306-9567-4cc9-a0a4-2f3058645bc9.png)

   \
   \
   > c. ここでは、まずこのフィルターに「有効な商品」という名前を付け、\n次に「フィルターパス」を選択し、カーソルでフィルター対象のブロックをクリックします。![](attachments/f15bf613-ac9b-4fb0-bba9-9070422c8a2c.png)
   >
   > \

   ![](attachments/f8d745fa-133b-4629-8dd4-a94d3300ecfe.png)

   \
   フィルター対象のブロックを選択します。![](attachments/59fbad53-b11a-4f9c-a250-d6e5ff50bda8.png)

   \
   \
   > d. 「フィルター条件」をクリックし、条件を設定します。
   >
   > ![](attachments/37700ee7-9451-4248-bd0a-cc8fbee8335f.png)

   ![](attachments/4b6c3bee-89f0-4bbe-bb41-fa049604363f.png)

   \
   \
   \
   > e. 左側のドロップダウンから「enable」項目を選択し、演算子に「=」を指定します。\n「パラメータ値のパス」には定数値「1」を入力してください。\nこれは、`table1` の `body` において、`enable = 1` のデータのみを取得対象とする設定です。

   ![](attachments/a88ece44-7e6d-4ef6-b6d3-e0daf463243e.png)

   \
   ![](attachments/26a1b659-cbd7-41b4-9246-c5a5022ce125.png)

   \
   \
   \
   \
   > f. 上記のステップ3で作成した「FormLoad」イベントを使用し、\n「Datamodelデータの読み込み」を選択してから、フィルターとして「有効な商品」を指定します。![](attachments/a3f33d4c-f3ad-4731-8ed8-d25b25eb7e35.png)

   \
   \
   ![](attachments/d62d446a-6349-4e60-baae-a90f8e66e851.png " =1047x355")

   \
   \
   \
   > g. 上記と同様の手順で、商品カテゴリを読み込むためのテーブルにもフィルターを設定します。ただし、カテゴリについては条件を設定しないため、フィルター条件は空白のままで構いません。
   >
   > ![](attachments/dfe497e8-1505-4364-92c9-aa24408a1c44.png)

   \
   \
   > h. ステップfの後に、「==読み込むDatamodelデータ==」をもう一つ追加し、フィルターとして「ca」を選択します。\nその後、プレビューを再度実行し、有効状態のデータのみが取得されていることを確認してください。![](attachments/7f3834f2-e8ca-42d5-aac8-1f1c01a79134.png)

   ![](attachments/59240bf2-3b3e-4770-b9bd-d29e324dd9e1.png)

   \
   \
   \
   **2** 左側のカテゴリを選択すると、右側には同じカテゴリに属する商品のみが表示されるようにします。

   > a. 
   >
   > 新しいフィルターを作成し、名前を「カテゴリによって商品を表示する」とします。フィルターの対象パスには、商品明細のテーブルを指定してください。

   ![](attachments/2934035a-83b1-44fb-aa0d-847791f1c96f.png)

   \
   > b. フィルター条件は以下のとおりに設定してください。\n商品カテゴリおよび有効状態の両方でデータを絞り込む必要があります。
   >
   > 
:::tip
   > * 条件1：「category」＝ `$.table2.body.#.ca`\n → `table2` の `ca` フィールドの値と一致する商品カテゴリのみを対象とします。
   > * 条件2：「enable」＝ `1`\n → 有効状態（`enable = 1`）の商品のみを対象とします。
   >
   > :::

   ![](attachments/265fe35c-c2b2-4bf6-a2d5-6287a18ab72b.png)

   ![](attachments/c516facb-7c1a-4334-8d0f-154a52a53e5d.png)

   \
   \
   \
   \
   > c.上部のアイコンをクリックし、「click」イベントを新規作成します。\nイベントには「==読み込むDatamodelデータ==」アクションを組み合わせて設定してください。

   ![](attachments/7c85484e-a694-450a-b63d-dc2f7762bb8a.png)

   \
   \
   \
   > d. 商品カテゴリの行（row）をバインドします。

   \
   ![](attachments/0304f62d-525f-4a28-be90-ba2f6ce17d3b.png)

   \
   \
   \
   > e. 「==読み込むDatamodelデータ==」アクションを設定し、フィルターとして「カテゴリ選択かつ有効」を選択します。
   >
   > \

   \
   ![](attachments/c7166023-5a0f-4a45-af42-fb09a8db7a5c.png)

   \
   \
   \
   \
   \
   > f.左側のメニューをクリックし、フィルターが正しく動作していることを確認します。

   \
   ![](attachments/44eb1a66-c15f-4433-ae73-ea5e88006fa0.png)

   \
   \
   \

### 5. 在庫数のフィルター


* > a.inputとbuttonのコンポーネントを追加します

|    | ID | Name |
|----|----|----|
| input | quantity_filter | quantity_filter |
| button | filter_btn | filter_btn |

  \
  \
  \
  \
  ![](attachments/35e0d7d8-1bb5-4dab-8f94-6c379a85e117.png)

  \
  > b.  新しいフィルターを作成し、名前を「在庫数の判断　＆　enable = 1 (有効な商品)」とします。\nフィルターの対象パスには、商品明細のテーブルを指定してください。
  >
  > ![](attachments/e8604f88-6aae-4ece-8358-dd417d9d3d2f.png)

  \
  \
  \
  \
  > c. フィルター条件は以下のとおりに設定してください。\n商品カテゴリおよび有効状態の両方でデータを絞り込む必要があります。
  >
  > 
:::tip
  > `quantity = $.quantity_filter` とは、「商品のカテゴリ（種類）が table2、つまり「カテゴリ」テーブルの `demo_material_stock_category` カラムと一致する必要がある」という意味です。
  > * `enable = 1` とは、「有効な商品だけを取得する」という意味です。
  >
  > :::

  ![](attachments/10124577-c12a-4d27-b390-3dea104afbf1.png)

  \
  > d. フィルター条件の値には、`quantity_filter` をデータソースとして指定してください。

  ![](attachments/f13665fd-7278-4677-b34f-2b5ea90f28b8.png)

  \
  \
  > e.フィルター用のボタンにイベントをバインドしてください。

  ![](attachments/e283bf4f-8e50-424d-9d8a-1fbbfe6bc3b5.png)

  \
  > f. Datamodel に、先ほど作成したフィルターを設定してください。

  ![](attachments/e7a54d52-2539-4ca4-b2b3-1a5d04971b20.png)

  \
  > g. 数量フィルターに「10」と入力し、フィルターボタンをクリックしてテストを行います。条件に一致するデータが正しく絞り込まれて取得されることを確認してください。
  >
  > ![](attachments/6dff1619-8439-4906-8bd9-d58c98484607.png)

  \
  \
  \

### 6. データを手動で追加するには、`uiModal` を使用します。

* 
:::tip
  学習目標 : イベントを使用して `uiModal` を起動し、商品明細の新規追加を行います。

  :::

  \
  6\.1 商品を登録するための専用ページを新規作成します。

  > a. 新しいページを作成し、「==商品登録UIModal==」という名前を付けてください。\nページのレイアウト構成は、以下の図のとおりです。

  ![](attachments/82ef6f3f-5640-433f-b356-42cade5750df.png)

  \
  \
  > b. 構成されたUIコンポーネント 

| コンポーネント | 說明 |
|----|----|
| tabs　商品登録 | layoutを整えて、テーブルをtabsの画面内に配置します。 |
| button　​商品を追加 | テーブル内に明細行を追加します |
| table | 在庫管理と同様に、在庫商品テーブルのカラムを追加します |
| button　​登録 | 新しい商品の保存を実行し、そして該当のモーダルを閉じます |

  \
  > c.テーブル内の項目（カラム）

| コンポーネント | カラム ID | カラム名 | 説明 |
|----|----|----|----|
| input | StockID | StockID | コードモードで自動的にguid生成します\nif ($nt.formData.table1.body[$nt.dataIndex\].StockID) { return $nt.formData.table1.body[$nt.dataIndex\].StockID } else { return $nt.formData.table1.body[$nt.dataIndex\].guid } |
| input | productcode | 商品コード | 商品コード |
| input | productname | 商品名 | 商品名 |
| input | quantity | ​在庫数 | 在庫数 |
| input | remark | ​備考 | 備考 |
| select | ca_d | ​カテゴリ | DPSでカテゴリの種類を取得する |
| input | enable | 有効 | enabled = 1 (有効な商品) |

  ![](attachments/386c5066-c1d6-4a82-806f-9609fbd659b9.png)

  \
  > d.  商品カテゴリのドロップダウンに対して、DPS（データ提供サービス）を設定します。

  
  1. 上方選單新增DPS 上部メニュー(==プロジェクト/ページ/コンポーネント管理==)から「DPSの追加」をして、新規追加します。

     ![](attachments/7b06ecaa-108a-4c92-b1cb-ec1b1995b469.png)

     \
     \
  2. 命名:カテゴリselector
  3. 新しいステップを追加し、そして==category selector==を命名してください。![](attachments/a480b8a7-29c1-4860-8ab8-344bb0a668b8.png)

     \
     \
     \
     \
     \
     \
  4. Type に「Datamodel」を選択し、モードは「クエリ」に設定します。\nその後、「パラメータ構造体の生成」をクリックしてください。![](attachments/ec7a76cd-6d46-43e6-9981-3c0aae128374.png)

     \
     \
     \

  > e.  ドロップダウンに DPS（データ提供サービス）をバインドします。

  
  1. ドロップダウンコンポーネントをクリックします。

     ![](attachments/1bc095a2-da80-49e0-805c-dd8a50675a31.png)

     \
     \
  2. 右側の設定エリアで、タイプとして「DPS」を選択し、\n「**==データリンク内容==**」をクリックしてください。

     ![](attachments/9867a9ce-72cd-43ad-ae80-28e6150dfcaa.png)

     \
     \
     \
  3. ステップ①：先ほど作成した DPS「==カテゴリの選択器==」を選択します。![](attachments/be45ebdd-cfd3-41d1-a9ba-0ae12cbe961a.png)

     \
  4. ステップ③に進み、データをフロントエンドにマッピングします。

     ![](attachments/54272625-a9a1-48e8-a65c-549a47c01d06.png)

     \
     \
     \
     \
     \
  5. ドロップダウンにデータが正しく取得されていることを確認します。\n![](attachments/3ace8131-f7f9-4d9a-9c35-c0269f713864.png)

     \
     \
     \

  \
  > f.  「enable」というInputに固定値「0」を設定します\n![](attachments/a50d9b6a-fe17-4982-8547-3f0d16b52c88.png)

  \
  \
  > g. 「商品追加」ボタンにイベントをバインドし、イベントアクションとして「==テーブル行を追加==」を設定します。
  >
  > ![](attachments/e6c35674-1e4d-43d6-bdd0-9d89b190e423.png)

  \
  \
  \
  > あわせて、テーブルのボディ部分にデータをバインドしてください。
  >
  > ![](attachments/7361563b-6832-4d78-abd7-0258c18273dc.png)

  \
  \
  \
  \
  \
  \
  \
  > h. 右下の保存ボタンにClickイベントを追加し、以下のアクションを設定します
  >
  > 
  > 1. 保存 Datamodel データ
  > 2. UIモーダルの閉じる処理

  ![](attachments/47fdc5c6-dda2-4b15-b667-28aac6f38581.png)

  \
  \
  \nトリガー関数を使用して、以下のコードを記述します

  ![](attachments/dd275c13-554f-4b31-a89c-7b3c971e6ad3.png)

  ![](attachments/70bbc05d-6c10-4824-be5b-d5a9eb20fe7e.png)

  ```javascript
  $nt.datamodel.saveData();
  $nt.uiSelector.close(true,"","")
  ```

  \
  3\.2 親画面から「商品作成モーダル」を呼び出します

  
:::info
  このステップでは在庫管理画面に戻り、UIモーダルイベントを使用して先ほど作成した新規画面を呼び出します

  :::

  
  1. 新しいカスタムイベントを作成します　➝　==新規商品を保存と材料在庫のデータをリロード==

     
:::tip
     このイベントは、UIモーダルを閉じた後に親画面の商品データを更新するために使用されます

     :::

     ![](attachments/0635d092-87c6-4746-a07a-fba2feefe348.png)

     \
     \
  2. 「読み込むDatamodelデータ」イベントを追加し、フィルターを使用して有効なデータのみを取得します。![](attachments/c8ada5cc-c24c-493a-b695-16921e13edd5.png)

     \
     \
     \
     \
     \
  3. 「商品を追加」ボタンにバインドして、新しいイベントを追加します。\n

     ![](attachments/19696caf-e5a4-4c93-8fe4-0ee4226a1e25.png)

     \
     \
  4. 「UIモーダル」のイベントを使用します。

     ![](attachments/d41dbd63-6e53-4eb3-88a5-65d1b5bff33f.png)

     \
     \
     \
     \
     \
     \
  5. 先ほど作成したUIを選択します。

     ![](attachments/db8f9525-2277-4490-8845-4117f62cce62.png)

     \
     \
  6. 詳細設定のパラメータを調整します。

     ![](attachments/1d999c7d-a448-4778-8f63-146f32bbe2f7.png)

     \
     \
  7. callbackを設定します。イベントモードを使用し、先ほど設定した\nCustomEventを選択します。

     \
     ![](attachments/f547a77c-fc81-4b8f-939d-8e466c0f3c5e.png)

     \
     \
  8. UIモーダルを呼び出し、テストデータを入力して新規データを登録してください。

     → 商品登録後、画面に新しいデータが正しく取得・表示されることを確認します。

     ![](attachments/484b9548-3cf6-4fc0-9720-0add748d5808.png)

     \
     \
     \
     \
     \
     登録完了後、画面が即時に更新されていることを確認してください。

     \
     ![](attachments/2f42c00f-ed2f-4131-8f23-1b86dc9713c7.png)

     \
     \
     \
     \
     \

### 7. データのエクスポートおよびインポート（Excel)

* **7.1 データのエクスポート**

  7\.1.1 ボタンを新規作成し、「==Excelインポート／エクスポート==」イベントをバインドしてください。

  \
  ![](attachments/ca19cc58-d171-4221-a1fa-057896888b9d.png)

  \
  \
  \
  \
  \
  \
  7\.1.2 **「==excel インポート / エクスポート==」**を開き、「タイプ」で「エクスポート」を選択します。エクスポート時の「ファイル名」は自由に入力できます。

  \
  ![](attachments/f5708cb6-52f4-4848-90e8-ea78d132d788.png)

  \
  \
  \
  7\.1.3 対応するExcelファイルを準備して、==「出力パラメータ」==設定画面でアップロードしてください。

  ![](attachments/90c7a999-62ea-4028-ab1f-34a484bd4942.png)

  \
  \
  \
  7\.1.4 ファイルを選択し、Excelファイルをアップロードし、UI上の項目とExcelの列をマッピングしてください。

  ![](attachments/1dc7d40c-a8cf-4fc7-acf5-8948203f6905.png)

  \
  ![](attachments/18e8e81d-be5d-4f76-ac67-49a33cc7841e.png)

  \
  7\.1.5 エクスポートとバリデーション

  ![](attachments/4399f427-817e-4c01-8a27-c6d6e6e7e10f.png)

  \
  ==データが正しくエクスポートされていることを確認する==

  \
  ![](attachments/5eaea6cb-2e9d-4c46-850f-28c161d299fa.png)

  \
  \
  **7.2 データのインポート**

  7\.2.1 ボタンを新規作成し、「==Excelインポート／エクスポート==」イベントをバインドしてください。

  ![](attachments/fe6b825d-3b16-4706-89b6-b0e2f188c99b.png)

  \
  \
  7\.2.2 **「==excel インポート / エクスポート==」**を開き、設定画面に入ります。\nタイプは「インポート」を選択し、以下のように設定してください。

  \
  \
  \
  ![匯入excel設定](attachments/710e5775-9f18-4c24-878e-1498a5773fa1.png)

  \
  \
  \
  \
  7\.2.3 対応するExcelファイルを準備して、==「出力パラメータ」==設定画面でアップロードしてください。\n`stockID` 項目はコードモードで制御されているため、StockIDに接続する必要はありません

  ![](attachments/aea26a71-7bde-4265-82ce-0acad8cc313f.png)

  \
  \
  \
  7\.2.4 Excelファイルをアップロードし、UIの各フィールドをExcelの項目にマッピングしてください。

  ![](attachments/38314c9a-4967-4621-9b0e-6098bfae703c.png)

  \
  \
  7\.2.5 先ほど作成したボタンを使用してファイルアップロードを実行し、アップロードするデータを選択してください。

  ![](attachments/2caeb62f-73aa-4289-bfe6-38797212d407.png)

  \
  \
  \
  7\.2.6テーブルにデータが表示されていることを確認し、「保存」ボタンを押下して DataModel への保存を実行してください。

  
:::tip
  StockID 項目はコードモードで制御されており、テーブル内の GUID を自動で取得します。そのため、ユーザーが手動で入力する必要はありません。

  :::

  ![](attachments/f7667504-7642-4765-9e6c-3bf6dfd19e9e.png)

  \
  インポートした後、「データを保存」をクリックしてください![](attachments/3154142b-7d97-49fb-8f2d-031a02799cca.png)

  \
  \
  7\.2.7 データモデルのデータを確認し、正常に書き込まれた機能を確認します。

  ![](attachments/287bffef-8d63-4752-b4f0-cbb38942316e.png)

### 8. **新しい**材料**を追加できる申請を作成します。**

#### 8.1 BPMを追加します


1. Bpmの追加を押して、新しいBpmを作成します

   \
   ![](attachments/dec2f4cf-87c7-4ded-b35a-40d652c2c3c9.png)

   \
2. Bpmフォローの命名：「商品登録Bpm」

   ![](attachments/e9f84a6b-792c-4240-8124-67898a9f2c69.png)

   \
   \
3. ステップ１を追加します。
   * エイリアスの命名：上司承認者
   * * 承認者は申請者の上司を選択してください

   \
   ![](attachments/2263c11e-cd3c-4b91-86f0-62d3766d4c2e.png)

   \
4. ステップ2を追加します

* エイリアスの命名：ANSEL


* * 承認者はANSELを選択してください

  ![](attachments/e5e5662f-179b-42ec-8775-0c452d4d7f34.png)

  ![](attachments/d1d13d67-9337-4a61-94c6-8f5c5e082f14.png)

  \
  \
  \

#### 6.2 Bpmフォローをバインディングします


1. ページ：商品登録のModal

   \
   ![](attachments/b0554dc6-7c7c-4b4f-8f38-87fb053ea799.png)

   \
   \
   \
2. アイコンをクリックし、Bpm設定を開きます

   ![](attachments/657f7a59-77a6-482c-a18b-8b2d00cd1c56.png)

   \
   \
   \
   \
   \
3. #### Bpmフォローをバインディングします
   * 商品登録Bpmを選択します
   * 各フィールドを設定します
   * 承認フローの最終段階に限り、承認者が「enable」フィールドを編集することが可能です。
   * 
| **フォーム名** | 商品登録（自由に入力） |
|----|----|
| **フォーム ID** | product_apply（自由に入力） |
| **フローチャート** | 商品登録Bpm |
| **フォームフォルダー名** | トレーニング |
| **フォームのシリアル番号** | IT-APPLY-%c3 |

     \n

   ![](attachments/0009691e-c78e-4a53-966d-313331594127.png)

   上司承認者のステップで`enable`inputをラックします

   \
   ![](attachments/ef56998b-a610-4e56-ae66-ee2a8a0085cb.png)

   \
   \
   \
4. Datamodel に、新しい申請を生成される唯一の識別子（pid）をバインドしてください

   \
   
:::tip
   BPM申請フォームのフローに紐づける際、各申請ごとに pid（ユニークキー）が生成されます。

   そのため、各申請の pid を保存するための「商品登録申請（demo_material_stock_apply）」というDataModelを新たに作成する必要があります。

   そして、pid = pid の関連付けを通じて、「商品登録申請」と「材料在庫」DataModel を連携させます。

   :::

   4\.1 申請を作るために、==材料在庫==　のスキーマを`pid`を追加します\n![](attachments/b3b42973-25fd-4246-a802-de871bbf9774.png)

   \n![](attachments/59dfea98-5212-4ceb-9a70-6086b6824101.png)
5. 商品登録申請DataModelを作成する　(BPMプロセスのユニークキー)

   \
   \
   ![](attachments/8d7c182c-5046-4281-9cfa-461828ac95ea.png)

   ![](attachments/5fa5c20e-5873-4a56-9610-b3206e2dc959.png)

   \n![](attachments/ff188a83-3b23-4327-a9ca-9486c8865ab0.png)


:::tip
申請としてページをBPMにバインドするために、テーブルにpidと関連付けるフィールドを追加してください。

:::

 ![](attachments/1857e924-d058-4f90-96e4-ae51323252fc.png)


#### 6.3 プロジェクトの権限を与えることについて


1. ==プロジェクト情報==をクリックします

   ![](attachments/d0292bce-0133-4379-aa3d-a571134d059b.png)

   \
   \
   \
2. プロジェクト統合 → プロジェクト統合の追加 → Matrix BPM Suite (v1)を統合します

   \
   ![](attachments/c3a63663-c210-4e45-9162-78a080d0e645.png)

   \
   \
   \
   \
3. システム権限管理 → 新しい権限を作成 → 対象で全社を追加する → BPMの権限を与えます（ダッシュボード、よく使う機能） 

   ![](attachments/ad3cfc2e-aea2-4692-b904-ac67f3b5a5f3.png)

   \
   \
   以下の資料とスイッチを設定してください。

   \
   ![](attachments/557810f7-fabd-419a-998e-42f1205f0869.png)

   \

#### 6.4 プレビュー


1. 「プレビュー」をクリックし、プロジェクトのプレビューを開きます

   ![](attachments/d7de716e-189d-4dc2-ba1a-c0b79eaacbaf.png)

   \
2. **開発者を選んでください**

   ![](attachments/4eb66c74-5fdf-4dc8-abcc-e6abefe11b15.png)

   \
   \
   \
   \
   \
3. 　「よく使う機能」をクリックし、「新しい申請」から「商品登録」を選択して、新規申請を行ってください。

   ![](attachments/eb0050a5-320a-467b-83ef-390b37a6c3d6.png)

   \
   テスト用の資料を入力してください\n![](attachments/fb3d8166-1476-41c7-953e-e75d371b2219.png)

   ![](attachments/d020452b-0a08-4d77-a3dc-002653a52e12.png)

   \
4. 申請者の上司による承認ステップに切り替えてください。\n![](attachments/4c601e87-f9d3-45c3-9d71-f83c98994952.png)

   \
   ![](attachments/78ccbaa5-e76d-49e2-8a4a-1e21eb9d76d3.png)

   ![](attachments/ea4fbd29-e3fd-4c9f-a9d1-72101bf849e5.png "right-50")

   \
5. 開発者「ANSEL」に切り替えて、申請の承認を実行します

   ![](attachments/1e5f399a-b354-4906-ac06-e9175f42a520.png)

   ![](attachments/df1b3330-c5ce-45e8-8df5-81d670eee287.png)

   \
   `enable` カラムの値を **1（有効）** に設定してください。![](attachments/5a479dd0-6bf1-4916-9e13-f48659ab4fc3.png)

   \
   \
6. **「プロセス終了」リストで該当申請を確認します**

   ![](attachments/d1fe80c6-ff98-4a33-afd1-9c45f93c7e6c.png)

   \
   \
   1\.申請書のデータ資料を正しいか確認してください\n2.承認履歴を確認してください

   ![](attachments/6d978170-97d1-4f53-8aef-ae9a445c939d.png)

   \

### 9.UIインターフェースの改善


:::tip
機能の動作を確認した後、`input` フィールドをロック（`disabled` 設定）し、システムデフォルトで生成される `pid`（※BPMとバインドすると必ず生成されます）および `enable` カラムを非表示にすることができます。


:::

> a. Table 内の input の無効化制御を、ロックアイコン（🔒）で切り替えるようにします。(inputをロックする目的は、フロントエンド画面の input ボックスに値を入力できないようにするためです。)\n
>
>  ![](attachments/ae2512af-8a71-44de-a4a4-b5fee0bb0688.png)


> b.`StockID` のラベル、`input` フィールド、および `enable` カラムの表示設定をすべて「表示する」に設定します。\n結果として、ユーザー画面ではこれらの項目は非表示となります。
>
>  ![](attachments/c467ede3-d940-4709-88c7-ed25db3997f5.png)
>
>  ![](attachments/fb971a02-d168-46f1-81f9-8a3027500d42.png)
>
> \


> c. また、「在庫数」以外に、すべての項目を「**無効化設定** （disabled）」に設定します。\n
>
>  ![](attachments/af17b8cc-f13e-49fe-aeb2-aff757e85edc.png)\nd. 在庫数を変更する可能となるために、「データを保存」Buttonを「保存DataModelデータ」にバインディングします。 ![](attachments/d4b29d8f-0581-4377-9091-c180dfdb4618.png)
>
> \
> 実装結果の画面は以下の通り :\n ![](attachments/08ecd946-59d7-4971-9016-878b03a22d41.png)\n
>
> \

## 5. BPM Portal の利用方法

### 1. BPM ホームページの紹介


:::tip
BPMのホーム画面は、システム内で最も重要な部分です。\nダッシュボードを通じて、申請フォームの最新状況を把握することができます。

:::

> 機能エリア紹介
>
> \
>  ![](attachments/2038d76b-b6fb-4962-9f44-fbe67d901fbb.png)

| 分類 | 機能の說明 |
|----|----|
| **承認待ち** | 承認待ちの申請件数 |
| **他者の代理** | 代理申請した件数 |
| **進行中** | 進行中の申請件数 |
| **プロセス終了** | 完了した申請件数 |
| **追跡中** | 承認時に［申請を追跡］を選択した件数 |
| **下書き (**ドラフト**)** | 保存された申請下書き件数 |
| **統合検索** | クリック後、申請検索画面へ遷移 |
| **新しい申請** | クリック後、申請受領画面へ遷移 |

### 2. 申請書の使い方について

#### 2.1 申請に入力します


:::tip
「**新しい申請**」画面にアクセスしてください

:::

この画面には、申請可能な申請書が表示されます。

 ![](attachments/39919b0e-c4f5-4830-92fe-e21c864c8713.png)


\
申請をクリックするとポップアップ画面（申請書）が表示され、申請書の入力画面が開きます

 ![](attachments/764be1c0-e8ec-4077-893e-7aae471a6353.png)


> 申請書の下部には、共通機能として以下の項目が用意されています :
>
> 
> 1. 承認履歴の表示
> 2. 申請関連
> 3. 外部リンク
> 4. ファイルアップロード
> 5. **「申請に記入して送信」** または**「ドラフトを保存」** を選択することができます。
>
> \
>  ![](attachments/d252af7e-b2cf-43ec-9424-f4235a23b803.png)

#### 2.2 簽核機能承認機能について


1.  却下
2.  承認
3. その他


:::tip
承認待ちの申請は様々な承認機能が使用できます\n ![](attachments/adf41e19-04da-4944-abd3-0544d7a45c06.png)


:::

「その他」ボタンをクリックすることで、各種機能をご利用いただけます。\n ![](attachments/9824ad14-e795-4b9a-af0c-2e7dcc7f52d3.png)


**名詞の解説**

| 機能名 | 機能說明 |
|----|----|
| 承認 | 承認されると、プロセスは次の承認者を自動的に検索して進行します。 |
| 却下 | 差し戻しが発生した場合、設定された差し戻しルートに従って処理が戻ります。 |
| 補足資料 | 指定されたステップに差し戻して、申請内容を修正後、そのステップからワークフローを再開します。 |
| 否決 | 申請書がそのまま終了となります。 |
| 諮問 | 指定された対象者に対して承認依頼の通知を送信しますが、該当者が「承認」または「却下」を選択しても、申請書のフローには影響しません。ただし、対応結果はすべて承認履歴に記録されます。 |
| 指示を求める | 指定された対象者に対して加筆の承認依頼を行い、対象者が同意すると、申請書は現在の担当者に戻ります。 |
| 委任 | 承認権限を指定の対象者に委譲し、その後のフローは元の承認者に従って進みます。 |
| 転移 | 承認権限を指定ユーザーに完全に引き継ぎ、以降の承認フローはそのユーザーを基準として処理されます。 |
| 指定 | 次の承認ステップに進む際の承認者を指定します。 |


### 3. 申請書の検索について


:::tip
左側の「よく使う機能」または「申請リスト」をクリックすることで、「申請リスト」にアクセスできます。

:::

> 画面に入ると、デフォルトでは申請書は表示されません。 ![](attachments/b6895c68-b8a5-4541-9855-e7eac69e97a8.png)
>
> \
> \
> 検索したい申請を、プルダウンメニューから選択ください。 ![](attachments/8a8bae7c-0dc1-49f0-a6f8-75d88021af80.png)
>
> \
> \
> デフォルトでは、ログインユーザーが申請または承認したフォームが表示されます。 ![](attachments/05252d67-9615-4b84-933b-b1484bd622ec.png)
>
> \
> \
> \
> 右側のフィルターを開くと、さまざまな条件を設定できます。
>
>  ![](attachments/4b03dc88-96a2-4055-9070-d8c7fc82429c.png)
>
> \
> フィルタのインターフェース：\n ![](attachments/8f31d98e-adf5-443a-9667-cc0aec9febd6.png)
>
> \
> ユーザーは、各種の設定項目に基づいて、検索したい申請書を絞り込むことができます。
>
> 
:::success
> 主旨や申請番号は、曖昧検索に対応しています。
>
> :::


\

\